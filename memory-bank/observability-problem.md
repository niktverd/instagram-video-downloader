# Проблема наблюдаемости процессов

В текущей архитектуре пайплайна (webhook → sources → скачивание → pubsub → cloud-run → preparedVideos → публикация → instagramMediaContainers) отсутствует прозрачная и централизованная система отслеживания статусов и ошибок на каждом этапе.

## Основные симптомы:

- Нет единого места, где можно увидеть статус каждого видео: "в обработке", "готово к публикации", "опубликовано", "ошибка" и т.д.
- Неясно, на каком этапе находится конкретное видео — приходится вручную смотреть разные таблицы (sources, preparedVideos, instagramMediaContainers).
- Ошибки теряются или не агрегируются: сложно понять, где и почему что-то сломалось (скачивание, cloud-run, публикация и т.д.).
- Нет удобного способа мониторить "живые" процессы (что сейчас в работе, что застряло, что завершено).
- Нет истории переходов статусов (трассировки) для каждого видео.

## Последствия:

- Сложно быстро реагировать на сбои и задержки
- Нет прозрачности для поддержки и анализа
- Растёт технический долг и риск "невидимых" ошибок

# Observability Problems in Cloud Run Video Pipeline

1. Нет мониторинга статуса задач (in-flight, success, fail, stuck)
2. Нет алертов на аномалии (runaway tasks, resource leaks, queue backlog, DB errors)
3. Нет трейсинга по задачам (нет correlation id, trace id, логи смешиваются)
4. Нет лимитов/guardrails (нет автоматической остановки runaway задач, нет ограничения на concurrency)
5. Нет dead-letter queue и контроля ретраев (бесконечные ретраи, нет DLQ)
6. Нет метрик по стоимости (нет cost breakdown per video/scenario/account)
7. Нет контроля за зависимостями (нет health-checks, задачи запускаются при недоступности базы)
8. Нет централизованного логирования и поиска (нет агрегации логов, нет фильтрации)
9. Нет визуализации очереди/прогресса (не видно сколько задач в очереди, в работе, завершено, упало)
10. Нет аудита и истории (кто запускал, параметры, кто отменил/перезапустил)
11. Нет контроля за ресурсами (CPU/RAM/disk leaks, деградация)
12. Нет автоматического масштабирования под реальные нужды (over/underprovisioning)
13. Нет контроля за идемпотентностью (дублирующиеся задачи)
14. Нет возможности отменить задачу (нет cancel API)
15. Нет интеграции с CI/CD для быстрого отката (деплой сломан — все падает)

## Последствия

- Потери денег (runaway tasks, resource leaks, бесконечные ретраи)
- Потери данных (некорректные задачи)
- Сложности с поддержкой и развитием (невозможно понять, что происходит)
- Сложности с SLA (невозможно гарантировать время выполнения)
- Сложности с дебагом (невозможно найти причину проблем)

## Что делать

Внедрять observability: метрики, трейсинг, алерты, централизованные логи, дашборды, лимиты, dead-letter queue, health-checks, cost tracking, визуализацию очереди, audit trail, idempotency, возможность отмены задач.
